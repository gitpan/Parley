<div id="logger"></div>

[% PROCESS shared/loading_please_wait %]

<div style="margin-top:10px;"></div>
<div class="thread_header">
    <a href="forum/view?forum=[% current_forum.id %]">[% ForumCode.escape(current_forum.name) %]</a>
    &nbsp;:&nbsp;
    [% ForumCode.escape(current_thread.subject) %]
</div>

[%# different action depending on whether we're adding to a thread or replying to a specific post %]
[% IF current_post %]
<form action="thread/reply?post=[% current_post.id %]" method="POST" name="new_thread">
[% ELSE %]
<form action="thread/reply?thread=[% current_thread.id %]" method="POST" name="new_thread">
[% END %]

<!-- The post we're replying to -->
<table style="margin-top:10px;">
  <tr>
    <td class="post_subject">
      [% responding_to_post.subject %]
    </td>
    <td class="post_creator">
      [% responding_to_post.creator.forum_name %]
    </td>
    <td class="post_created">
      [% nicedate(responding_to_post.created) %]
    </td>
  </tr>
  
  <tr>
    <td colspan="3" class="reply_post_message">
          [%l('Replying To')%]:
      <div class="innerpost">
      [% FILTER html_line_break %][% HTML.escape(responding_to_post.message) %][% END %]
      </div>
    </td>
  </tr>
</table>

[% IF messages %]
<p>
    <ul>
        [% FOREACH message IN messages %]
            <li>[% message %]</li>
        [% END %]
    </ul>
</p>
[% END %]

    
<p style="padding:10px;">[%l('ENTER REPLY')%]:</p>


<table class="thread_reply">
  [% IF c.config.replies_have_own_subject %]
  <tr>
    <td> [%l('Topic')%] </td>
    <td>
      <input type="text" name="thread_subject" size="60" class="input_text" value="[% current_thread.subject %]" />
    </td>
  </tr>
  [% END %]

  [% IF quote_post %]
  <input type="hidden" name="have_quoted_post" value="1" />
  <input type="hidden" name="__post" value="[% quote_post.id %]" />
  <tr>
  <td>&nbsp;</td>
  <td>
    <span class="post_creator">
      [% quote_post.creator.forum_name %] [%l('said')%]:
    </span>
    <br />
    <textarea name="quote_message" cols="60" rows="10" class="quoted_reply_textarea" />[% quote_post.message %]</textarea>
  </td>
  </tr>
  [% END %]

  <tr>
    <td> [%l('Message')%] </td>
    <td>
        <textarea name="thread_message" id="thread_message" cols="60" rows="20" class="input_text" /></textarea>
    </td>
  </tr>

  <tr>
    <td>&nbsp</td>
    <td colspan="1" style="text-align: center;">
      <input type="button" value="[%l('Preview')%]"   accesskey="Z" name="post_reply" class="input_button" id="message_preview" />
      <input type="submit" value="[%l('Add Reply')%]" accesskey="X" name="post_reply" class="input_button" />
    </td>
  </tr>

  [% IF moderator %]
  <tr>
    <td>&nbsp</td>
    <td colspan="1" align="left">
        <input type="checkbox" name="lock_thread" value="1" /> [%l('LOCK AFTER POSTING')%] 
    </td>
  </tr>
  [% END %]
  <tr>
    <td>&nbsp</td>
    <td colspan="1" align="left">
        <input type="checkbox" name="watch_on_post" value="1" [% IF authed_user.preference.watch_on_post %]checked="checked" [% END %]/>
        [%l('ADD THREAD WATCH')%] 
    </td>
  </tr>
</table>
</form>

<style type="text/css">
	.yui-overlay { position:absolute;background:transparent;border:none;padding:none;margin:none; }
</style>

<!-- message preview majick -->
<script type="text/javascript" src="[%c.uri_for('/static/MessagePreview.js')%]"></script>
<script type="text/javascript">
    var MessagePreview = new ParleyMessagePreview();

    MessagePreview.config.label_preview = '[%l('Preview')%]';
    MessagePreview.config.label_edit    = '[%l('Edit')%]';
    MessagePreview.config.post_url      = "[%c.uri_for('/post/preview')%]";

    MessagePreview.init();
</script>
<!-- (end) message preview majick -->
